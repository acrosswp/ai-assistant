(()=>{"use strict";var s={n:a=>{var t=a&&a.__esModule?()=>a.default:()=>a;return s.d(t,{a:t}),t},d:(a,t)=>{for(var e in t)s.o(t,e)&&!s.o(a,e)&&Object.defineProperty(a,e,{enumerable:!0,get:t[e]})},o:(s,a)=>Object.prototype.hasOwnProperty.call(s,a)};const a=window.wp.element,t=window.wp.domReady;var e=s.n(t);const i=window.wp.components,n=window.wp.i18n,o=window.wp.apiFetch;var r=s.n(o);const c=window.wp.primitives,l=window.ReactJSXRuntime,d=(0,l.jsx)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,l.jsx)(c.Path,{d:"M7 11.5h10V13H7z"})}),h=(0,l.jsx)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,l.jsx)(c.Path,{d:"m13.06 12 6.47-6.47-1.06-1.06L12 10.94 5.53 4.47 4.47 5.53 10.94 12l-6.47 6.47 1.06 1.06L12 13.06l6.47 6.47 1.06-1.06L13.06 12Z"})}),m=({message:s})=>{const{role:a,content:t,type:e="regular",timestamp:i}=s,n="user"===a,o="error"===e;return(0,l.jsxs)("div",{className:`ai-assistant-chat-message ai-assistant-chat-message--${a} ${o?"ai-assistant-chat-message--error":""}`,children:[(0,l.jsx)("div",{className:"ai-assistant-chat-message__avatar",children:n?(0,l.jsx)("span",{className:"ai-assistant-chat-message__avatar-user",children:"ðŸ‘¤"}):(0,l.jsx)("span",{className:"ai-assistant-chat-message__avatar-bot",children:"ðŸ¤–"})}),(0,l.jsx)("div",{className:"ai-assistant-chat-message__content",children:(0,l.jsxs)("div",{className:"ai-assistant-chat-message__bubble",children:[(0,l.jsx)("div",{className:"ai-assistant-chat-message__text",children:t}),i&&(0,l.jsx)("div",{className:"ai-assistant-chat-message__timestamp",children:(s=>s?new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"")(i)})]})})]})},w=()=>(0,l.jsxs)("div",{className:"ai-assistant-loading",children:[(0,l.jsx)("div",{className:"ai-assistant-loading__avatar",children:(0,l.jsx)("span",{className:"ai-assistant-loading__avatar-bot",children:"ðŸ¤–"})}),(0,l.jsx)("div",{className:"ai-assistant-loading__content",children:(0,l.jsxs)("div",{className:"ai-assistant-loading__bubble",children:[(0,l.jsxs)("div",{className:"ai-assistant-loading__dots",children:[(0,l.jsx)("span",{}),(0,l.jsx)("span",{}),(0,l.jsx)("span",{})]}),(0,l.jsx)("span",{className:"ai-assistant-loading__text",children:(0,n.__)("AI is thinking...","ai-assistant")})]})})]}),_=({messages:s=[],isLoading:t=!1,error:e=null,onSendMessage:o,onResetChat:r,onClose:c})=>{const[_,u]=(0,a.useState)(""),p=(0,a.useRef)(null),x=(0,a.useRef)(null);(0,a.useEffect)(()=>{p.current?.scrollIntoView({behavior:"smooth"})},[s,t]),(0,a.useEffect)(()=>{x.current?.focus()},[]);const g=s=>{s.preventDefault(),_.trim()&&!t&&(o(_),u(""))};return(0,l.jsxs)("div",{className:"ai-assistant-chatbot-window",children:[(0,l.jsxs)("div",{className:"ai-assistant-chatbot-window__header",children:[(0,l.jsxs)("div",{className:"ai-assistant-chatbot-window__title",children:[(0,l.jsx)("h3",{children:(0,n.__)("AI Assistant","ai-assistant")}),(0,l.jsx)("span",{className:"ai-assistant-chatbot-window__subtitle",children:(0,n.__)("How can I help you today?","ai-assistant")})]}),(0,l.jsxs)("div",{className:"ai-assistant-chatbot-window__actions",children:[(0,l.jsx)(i.Button,{icon:d,size:"small",variant:"tertiary",onClick:()=>{s.length>0&&window.confirm((0,n.__)("Are you sure you want to clear the chat history?","ai-assistant"))&&r()},disabled:0===s.length,label:(0,n.__)("Reset chat","ai-assistant")}),(0,l.jsx)(i.Button,{icon:h,size:"small",variant:"tertiary",onClick:c,label:(0,n.__)("Close chatbot","ai-assistant")})]})]}),(0,l.jsxs)("div",{className:"ai-assistant-chatbot-window__messages",children:[e&&(0,l.jsx)("div",{className:"ai-assistant-chatbot-window__error",children:e}),0===s.length&&!t&&(0,l.jsx)("div",{className:"ai-assistant-chatbot-window__welcome",children:(0,l.jsx)("p",{children:(0,n.__)("Welcome! I'm your AI assistant. How can I help you with your WordPress site today?","ai-assistant")})}),s.map((s,a)=>(0,l.jsx)(m,{message:s},a)),t&&(0,l.jsx)(w,{}),(0,l.jsx)("div",{ref:p})]}),(0,l.jsx)("form",{className:"ai-assistant-chatbot-window__input-form",onSubmit:g,children:(0,l.jsxs)("div",{className:"ai-assistant-chatbot-window__input-wrapper",children:[(0,l.jsx)(i.TextareaControl,{ref:x,value:_,onChange:u,onKeyDown:s=>{"Enter"!==s.key||s.shiftKey||(s.preventDefault(),g(s))},placeholder:(0,n.__)("Type your message here...","ai-assistant"),rows:2,disabled:t,className:"ai-assistant-chatbot-window__input"}),(0,l.jsx)(i.Button,{type:"submit",variant:"primary",disabled:!_.trim()||t,className:"ai-assistant-chatbot-window__send-button",children:(0,n.__)("Send","ai-assistant")})]})})]})},u=()=>{const[s,t]=(0,a.useState)(!1),[e,o]=(0,a.useState)([]),[c,d]=(0,a.useState)(!1),[h,m]=(0,a.useState)(null),w=(0,a.useRef)(null),u=(0,a.useRef)(null);(0,a.useEffect)(()=>{p()},[]),(0,a.useEffect)(()=>{!s&&u.current&&u.current.focus()},[s]),(0,a.useEffect)(()=>{const a=a=>{"Escape"===a.key&&s&&t(!1)};if(s)return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[s]);const p=async()=>{try{const s=await r()({path:"/ai-assistant/v1/messages",method:"GET"});o(s||[])}catch(s){console.error("Failed to load messages:",s),m((0,n.__)("Failed to load chat history.","ai-assistant"))}},x=()=>{t(!s)};return(0,l.jsxs)("div",{className:"ai-assistant-chatbot",children:[(0,l.jsx)(i.Button,{ref:u,className:"ai-assistant-chatbot__toggle",variant:"primary",onClick:x,"aria-expanded":s,"aria-controls":"ai-assistant-chatbot-window",children:(0,n.__)("Need Help?","ai-assistant")}),s&&(0,l.jsx)("div",{id:"ai-assistant-chatbot-window",className:"ai-assistant-chatbot__window",ref:w,children:(0,l.jsx)(_,{messages:e,isLoading:c,error:h,onSendMessage:async s=>{if(!s.trim())return;d(!0),m(null);const a={role:"user",content:s,timestamp:Date.now(),type:"regular"};o(s=>[...s,a]);try{const a=await r()({path:"/ai-assistant/v1/messages",method:"POST",data:{message:s}});o(s=>[...s,a])}catch(s){console.error("Failed to send message:",s);const a={role:"assistant",content:s.message||(0,n.__)("Sorry, I encountered an error. Please try again.","ai-assistant"),timestamp:Date.now(),type:"error"};o(s=>[...s,a])}finally{d(!1)}},onResetChat:async()=>{try{await r()({path:"/ai-assistant/v1/messages",method:"DELETE"}),o([]),m(null)}catch(s){console.error("Failed to reset chat:",s),m((0,n.__)("Failed to reset chat history.","ai-assistant"))}},onClose:x})})]})};e()(()=>{if(window.aiAssistantChatbot&&window.aiAssistantChatbot.enabled){let s=document.getElementById("ai-assistant-chatbot-root");s||(s=document.createElement("div"),s.id="ai-assistant-chatbot-root",document.body.appendChild(s)),(0,a.render)((0,l.jsx)(u,{}),s)}})})();